#!/bin/sh
set -e
set -o errexit
set -o pipefail
set -o nounset


echo "â³ Aguardando Postgres em $POSTGRES_HOST:$POSTGRES_PORT..."
until pg_isready -h "$POSTGRES_HOST" -p "$POSTGRES_PORT" -U "$POSTGRES_USER"; do
  sleep 1
done
echo "âœ… Postgres disponÃ­vel!"

# Rodar migraÃ§Ãµes se necessÃ¡rio
if command -v alembic > /dev/null; then
  echo "ðŸ“¦ Rodando migraÃ§Ãµes..."
  alembic upgrade head
fi

echo "ðŸš€ Iniciando FastAPI..."
exec uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-8000} 